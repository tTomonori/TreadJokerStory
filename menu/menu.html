<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>menu</title>
</head>
<script>
	// You can also require other files to run in this process
	require('../renderer.js')
	const $=require("jquery");
	const electron=require("electron");
	const ipc=electron.ipcRenderer;
</script>
<style>
	body{
		margin: 0px;
		overflow: hidden;
		}

	.menu-window {
		width: 99.4%;
		height:99.4%;
		position:absolute;
		top: 0;
		color:#fff;
	}

	.menu-left{
		width: 30%;
		height: 100%;
		/*float: left;*/
		display: inline-block;
		background-color:#640bff;
		border:double;
		border-radius: 10px;
		font-size: 2em;
	}
	.left-modal{
		width: 30%;
		height: 100%;
		position: absolute;
		top: 0;
		left: 0;
		background-color: rgba(255,255,255,0.1);
		z-index: 1;
		border-radius: 10px;
		display: none;
	}
	.menu-right{
		width: 69.5%;
		height: 100%;
		/*float: right;*/
		display: inline-block;
		background-color:#640bff;
		border:double;
		border-radius: 10px;
		position: absolute;
	}
	.right-modal{
		width: 69.5%;
		height: 100%;
		position: absolute;
		top: 0;
		left: 30%;
		z-index: 1;
		border-radius: 10px;
		display: block;
	}

	.menu-list ,.inner-right{
		margin: 30px 40px 30px 40px;
		overflow: scroll;
	}

	::-webkit-scrollbar{
		width: 0px;
	}

	#templete{
		position: absolute;
		bottom: 0;
		width: 30%;
		text-align: center;
	}

	.pop-up-menu{
		background-color:#640bff;
		border:double;
		border-radius: 10px;
		font-size: 2em;
		position: absolute;
		color:#fff;
	}
</style>
<!-- そのまま使用するテンプレート -->
<div id=templete>
	<hr>
	お金<br>
	エレメント
</div>
<div id="pop-up-menu-tactics">
	<div class="menu-list">
		<div class="pop-up-tactics-list" id="pop-up-tactics-list-order">隊列</div>
		<div class="pop-up-tactics-list" id="pop-up-tactics-list-formation">陣形</div>
		<div class="pop-up-tactics-list" id="pop-up-return" onclick="popUpReturn()">戻る</div>
	</div>
</div>
<div id="pop-up-menu-deck">
	<div class="menu-list">
		<div class="pop-up-deck-list" id="pop-up-deck-list-order">編集</div>
		<div class="pop-up-deck-list" id="pop-up-deck-list-formation">一覧</div>
		<div class="pop-up-deck-list" id="pop-up-return" onclick="popUpReturn()">戻る</div>
	</div>
</div>

<!-- コピー用テンプレート -->
<!-- <div class="menu-window" id="" style="display:none">
	<div class="menu-left">
		間に何も入れない
		<div class="menu-list">
			<div class="" id=""></div>
			<div class="" id="return" onclick="changeWindow('main')">戻る</div>
		</div>
	</div>
	<div class="menu-right">
		間に何も入れない
		<div class="inner-right">
			<div>が選択肢になる
			<div class=""></div>
			<div class=""></div>
			<div class=""><div id="noSelect">選択肢にならないもの</div></div>
		</div>
	</div>
</div> -->
<body>

	<div class="menu-window" id="main-menu" style="display: block">
		<div class="menu-left">
			<div class="menu-list">
				<div class="main-list" id="main-list-item" onclick="changeWindow('item')">アイテム</div>
				<div class="main-list" id="main-list-member" onclick="selectRight()">メンバー</div>
				<div class="main-list" id="main-list-deck" onclick="popUpMenu('deck','main-list-deck')">デッキ</div>
				<div class="main-list" id="main-list-tactics" onclick="popUpMenu('tactics','main-list-tactics')">作戦</div>
				<div class="main-list" id="main-list-training">育成</div>
				<div class="main-list" id="main-list-map">マップ</div>
				<div class="main-list" id="main-list-option">設定</div>
			</div>
		</div>
		<div class="menu-right">
			<div class="inner-right">
				<div id="member-list">
					<h1>Main</h1>
					<div class="member-status" id="main-member"></div>
					<hr>
					<h1>Sub</h1>
					<div class="member-status" id="sub-member"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="menu-window" id="item-menu" style="display: none">
		<div class="menu-left">
			<div class="menu-list">
				<div class="item-list" id="consumption">消費</div>
				<div class="item-list" id="important">大事な物</div>
				<div class="item-list" id="return" onclick="changeWindow('main')">戻る</div>
			</div>
		</div>
		<div class="menu-right">
			
		</div>
	</div>
	<div class="left-modal" onclick="selectLeft()"></div>
	<div class="right-modal"></div>
	<div class="pop-up-window" style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;display: none;background-color: rgba(255,255,255,0.1);">
	<div class="pop-up-menu"></div>
	</div>
</body>
<script>
	var Pointer = -1;

	//お金とエレメントの表示
	for(var i=0;i<$(".menu-left").length;i++){
		$(".menu-left")[i].append($("#templete")[0].cloneNode(true));
	}
	//選択時にcss変更
	$(function(){
		$(".menu-list div").hover(function(){
			$(this).css("padding-left","20px");
		},function(){
			$(this).css("padding-left","0px");
		})
	})

	//キャラ表示
	var charaTable = $("<table style='width:100%'>");
	var tr = $("<tr>");
	tr.append("<td rowspan='4'>画像</td>");
	tr.append("<td colspan='2'>名前</td>");
	charaTable.append(tr);
	tr = $("<tr>");
	tr.append("<td>レベル</td>");
	tr.append("<td>職業</td>");
	charaTable.append(tr);
	tr = $("<tr>");
	tr.append("<td>HP</td>");
	tr.append("<td>MP</td>");
	charaTable.append(tr);
	tr = $("<tr>");
	tr.append("<td>HPゲージ</td>");
	tr.append("<td>MPゲージ</td>");
	charaTable.append(tr);
	$("#main-member")[0].append(charaTable[0]);

	//画面遷移
	function changeWindow(windowName) {
		$(".menu-window").css("display","none");
		$("#"+windowName+"-menu").css("display","block");
		popUpReturn();
		Pointer = -1;
	}
	//ポップアップ表示
	function popUpMenu(popUpName,thisId){
		var top = $("#"+thisId).offset().top;
		$(".pop-up-window").css("display","block")
		$(".pop-up-menu").css("top",top+"px")
		$(".pop-up-menu").css("left","200px")
		$(".pop-up-menu")[0].innerHTML="";
		$(".pop-up-menu")[0].append($("#pop-up-menu-"+popUpName)[0].cloneNode(true));
		Pointer=-1;
		$(function(){
			$(".menu-list div").hover(function(){
				$(this).css("padding-left","20px");
				Pointer = -1;
			},function(){
				$(this).css("padding-left","0px");
			})
		})
	}
	//ポップアップ削除
	function popUpReturn(){
		$(".pop-up-window").css("display","none")
		Pointer = -1;
	}

	//操作領域を右に移す
	function selectRight(){
		$(".left-modal").css("display","block");
		$(".right-modal").css("display","none");
		Pointer = -1;
	}
	//操作領域を左に戻す
	function selectLeft(){
		$(".left-modal").css("display","none");
		$(".right-modal").css("display","block");
		Pointer = -1;
	}

	//操作領域を返す関数
	function operateArea(){
		if($(".pop-up-window")[0].style.display=="block"){
			return "pop-up";
		}
		else if($(".left-modal")[0].style.display=="block"){
			return "right";
		}
		else{
			return "left";
		}
	}

	var selectList = $("<div>");
	function operateList(){//操作しているリストを返す
		if(Pointer == -1){
			if(operateArea()=="pop-up"){
				selectList = $(".pop-up-window")[0];//pop-up-window
				selectList = selectList.children[0];//pop-up-menu
				selectList = selectList.children[0];//pop-up-menu-??
			}
			else{
				for(var i=0;i<$(".menu-window").length;i++){
					if($(".menu-window")[i].style.display=="block")	{
						selectList = $(".menu-window")[i];
						break;				
					}
				}
				if(operateArea()=="right"){
					selectList = selectList.children[1];//右
					selectList = selectList.children[0];//innerがあるため
				}
				else{
					selectList = selectList.children[0];//左
				}
			}
			selectList = selectList.children[0];//リストまで下がる
			selectList = $(selectList).children("div");//リストの配列
			var tempList = new Array();
			for (var i = 0; i < selectList.length; i++) {
				if($(selectList[i]).children("#unselectable").length<1){
					tempList.push(selectList[i]);
				}
			}
			selectList=tempList;
		}
		return selectList;
	}

	//選択している要素を返す
	function selectedList(){
		if(Pointer==-1) return null;
		return operateList()[Pointer];
	}


	//キーボード操作
	$(window).keydown(function(e){
		if(e.keyCode==38){//↑
			selectPointer("up");
		}
		else if(e.keyCode==40){//↓
			selectPointer("down");
		}
		else if(e.keyCode==8){//backspace
			switch (operateArea()){
				case "pop-up":
					popUpReturn();
					break;
				case "left":
					changeWindow("main");
					break;
				case "right":
					selectLeft();
					break
				default:
					break;
			}

		}
		else if(e.keyCode==13){//Enter
			if(selectedList()!=null){
				selectedList().onclick();
			}
		}
		else{
			console.log("エラー：割り当てられてないキー操作","keyCode:"+e.keyCode);
		}
	})
	function selectPointer(operation){
		var list=operateList();		
		console.log(operateList());
		for(var i=0;i<list.length;i++){
			$(list[i]).css("padding-left","0px");
		}
		if(Pointer==-1) Pointer=0;
		else if(operation=="down") Pointer=(Pointer+1)%list.length;
		else if(operation=="up") Pointer=(Pointer+list.length-1)%list.length;
		$(selectedList()).css("padding-left","20px");
	}

</script>
</html>